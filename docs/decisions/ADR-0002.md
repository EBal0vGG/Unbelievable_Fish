

# ADR-0002: Реорганизация домена сделок



## Контекст
Ранее сделка создавалась в статусе `DRAFTED` при публикации лота (`LotPublished`), а затем дополнялась при выигрыше (`AuctionWon`). Это создавало проблему: сделка существовала юридически, хотя аукцион мог быть отменён.

## Решение
1. **Упразднён статус `DRAFTED`** — сделка создаётся только при `AuctionWon`, сразу в статусе `PENDING`
2. **Введена проекция сделки (`DealProjection`)** — создаётся при `LotPublished`, хранит снапшот продукта и данные продавца
3. **Factory** — преобразует проекцию в агрегат `Deal` при `AuctionWon`
4. **Добавлены статусы контракта** — `CONTRACT_PREPARED`, `CONTRACT_SIGNED` как обязательный этап перед оплатой
5. **Бизнес-методы возвращают события** — `([]Event, error)` вместо мутации + внутреннего хранения

## Последствия
-  Сделка — всегда юридически значимая сущность
-  Проекция живёт в домене Deal (read model)
-  Полный жизненный цикл контракта
-  Событийная модель для event sourcing

